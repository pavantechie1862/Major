<div class="card clear-margin">
    <div class="border mail-box card-body border-bottom-0 border-left-0 clear-padding" *ngIf="chat && chatUser">
        <div class="p-20 d-flex justify-content-between ">
            <h3>{{chat.chatInformation.chatName}}</h3>
            <div class="dropdown" dropdown>
                <a class="ki-click" dropdownToggle id="dropdown-menu">
                    <span class="ki ki-more-vertical "></span>
                </a>
                <ul class="dropdown-menu w-200 dropdown-menu-right" aria-labelledby="dropdown-menu" *dropdownMenu>
                    <li>
                        <a class="dropdown-item" (click)="openSmallModal(muteNotifications)"><i class="ki ki-bell"></i>{{isMuted}}</a>
                    </li>
                    <li (click)="makeFavorite()">
                        <a class="dropdown-item"><i class="ki ki-heart-fill"></i>{{isFavorite}}</a>
                    </li>
                    <li>
                    <a class="dropdown-item" (click)="openSmallModal(leavechat)"><i class="ki ki-flight-fill"></i>Block Contact</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="border h-400 screen-height-card bg-secondary px-20 py-8">
            <div class="card clear-margin align-items-center justify-content-center" *ngIf="chatUser.requestStatus==1 && currentUserId!=chatUser.requestedBy" >
                <div class="d-flex p-20 ">
                    <div class="employee-profile-header">
                        <div class="profile profile-120">
                        <div class="profile-picture-container">
                            <img class="profile-picture" src="../../../assets/apple.png" alt="">
                        </div>
                        </div>
                    </div>
                </div>
                <h1 class="font-weight-bold"> Jawahar wants to connect with you !</h1>
                <div class="d-flex align-items-center pt-16">
                    <i class="ki ki-bank"></i>
                    <p class="px-8 text-large">22 in Mutual</p>
                </div>
                <div class="d-flex justify-content-between w-50 p-20">
                    <div class="d-flex align-items-center">
                        <i class="ki ki-mail"></i>
                        <p class="px-8 text-large">sreejajangala@gmail.com</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="ki ki-phone"></i>
                        <p class="px-8 text-large">8374554113</p>
                    </div>
                </div>
                <h4>You and Jawahar Know</h4>
                <p class="px-8 text-large p-16">Vijay, Jahnavi, +21</p>
                <div class="d-flex pb-20 ">
                    <div class="border border-color-violet w-120 d-flex justify-content-center rounded mr-10">
                        <button class="btn text-accent-violet clear-margin clear-padding" (click)="connectChat()">Connect Now</button>
                    </div>
                    <div class="border border-color-violet w-80 d-flex justify-content-center rounded">
                        <button class="btn text-accent-violet clear-margin clear-padding" (click)="blockChat()">Block</button>
                    </div>
                </div>
            </div>

            <div class="card clear-margin align-items-center justify-content-center" *ngIf="chatUser.requestStatus==1 && currentUserId==chatUser.requestedBy" >
                <div class="d-flex p-20 ">
                    <div class="employee-profile-header">
                        <div class="profile profile-120">
                        <div class="profile-picture-container">
                            <img class="profile-picture" src="../../../assets/apple.png" alt="">
                        </div>
                        </div>
                    </div>
                </div>
                <h1 class="font-weight-bold"> You requested Vijay to Connect !</h1>
                <div class="d-flex align-items-center pt-16">
                    <i class="ki ki-bank"></i>
                    <p class="px-8 text-large">22 in Mutual</p>
                </div>
                <div class="d-flex justify-content-between w-50 p-20">
                    <div class="d-flex align-items-center">
                        <i class="ki ki-mail"></i>
                        <p class="px-8 text-large">sreejajangala@gmail.com</p>
                    </div>
                    <div class="d-flex align-items-center">
                        <i class="ki ki-phone"></i>
                        <p class="px-8 text-large">8374554113</p>
                    </div>
                </div>
                <h4>You and Vijay Know</h4>
                <p class="px-8 text-large p-16">Vijay, Jahnavi, +21</p>
                <h2 class="pb-8"> Waiting for Vijay to respond...!</h2>
            </div>

            <div class="d-flex flex-column  mb-10" *ngFor="let message of chat.messages">
                <div class="align-self-end" *ngIf="currentUserId == message.senderId && !message.messageBody.messageType ">
                    <div class="d-flex align-items-center my-10">
                        <div class="employee-profile-header">
                            <div class="profile profile-24">
                            <div class="profile-picture-container">
                                <img class="profile-picture" src="../../../assets/apple.png" alt="">
                            </div>
                            </div>
                        </div>
                        <h5 class="mr-10 text-normal text-primary text-capitalize">{{message.senderId}}</h5>
                        <h6 class="text-x-small text-secondary text-normal">{{message.messageTime | date:'MMM dd, YYYY \'at\' HH:MM' }}</h6>
                    </div>
                </div>
                <div class="card clear-margin p-12 w-300 align-self-end" *ngIf="(currentUserId == message.senderId) && !message.messageBody.messageType ">
                    {{message.messageBody.message}}
                </div>
                <div *ngIf="!(currentUserId == message.senderId) && !message.messageBody.messageType">
                    <div class="d-flex align-items-center my-10">
                        <div class="employee-profile-header">
                            <div class="profile profile-24">
                            <div class="profile-picture-container">
                                <img class="profile-picture" src="../../../assets/apple.png" alt="">
                            </div>
                            </div>
                        </div>
                        <h5 class="mr-10 text-normal text-primary text-capitalize">{{message.senderId}}</h5>
                        <h6 class="text-x-small text-secondary text-normal">{{message.messageTime | date:'MMM dd, YYYY \'at\' HH:MM' }}</h6>
                    </div>
                </div>
                <div class="card clear-margin p-12  w-300 " *ngIf=" !(currentUserId == message.senderId) && !message.messageBody.messageType">
                    {{message.messageBody.message}}
                </div>
                <div class="d-flex align-items-center my-20" *ngIf="message.messageBody.messageType">
                    <div class="flex-grow-1 mr-16">
                        <hr>
                        </div>
                            <p class="text-small text-secondary max-w-540 text-center">
                            {{message.messageBody.message}} is Instruction
                            </p><div class="flex-grow-1 ml-16">
                        <hr>
                    </div>
                </div>

            </div>
        </div>
        <div class="py-4 px-12">
            <div class=" d-flex align-items-center justify-content-between">
                <div>
                        <input type="text" (keydown.enter)="addMessage()" [(ngModel)]="message" class="form-control w-800 border-0" placeholder="Type Message Here" (focus)="changeToggle()">
                </div>
                <div>
                    <span>
                        <div>
                            <div class="d-inline-flex justify-content-center align-items-center">
                                <div containerclass="max-w-300" container="body" class="d-inline-block position-relative">
                                    <span class="cursor-pointer ki ki-lg ki-attachment text-accent-violet"></span>
                                    <input type="file" name="fileupload" class="input-file" title="No file chosen" accept=".png,.jpg,.jpeg,.doc,.docx,.pdf,.xps,.xls,.xlsx" (change)="uploadFiles($event)" multiple/>
                                </div>
                            </div>
                        </div>
                    </span>
                </div>
                <i class="ki ki-lg ki-face-smile text-success cursor-pointer"
                    (click)="toggled = !toggled" >
                </i>
                <div class="w-300 position-absolute right-0 top-50" *ngIf="toggled">
                    <ngx-emoj class=" z-index-2"
                        (onemojipick)="handleEmoji($event)"
                        >
                    </ngx-emoj>
                </div>
                <div>
                    <i class="ki ki-lg ki-send" (click)="addMessage()"></i>
                 </div>
            </div>
            <div class="w-100 screen-height-card overflow-scroll-x h-40" >
                <div class="d-flex">
                    <div class="chip-wrapper border-bottom-0" *ngFor="let item of files ;let i=index">
                        <div class="chips employee-profile-header">
                            <div displayname="Example Chip" firstname="Example" lastname="Chip" index="3" profileimageurl=""
                                class="profile profile-32">
                                <div class="profile-picture-container">
                                    <div class="profile-picture ng-star-inserted">
                                        <div class="img-initials bg-accent-violet">
                                            <i class="ki ki-attachment text-white"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <span class="name">{{item}}</span><span class="ki ki-cancel-circle" (click)="deleteFile(i)"></span>
                        </div>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>

<ng-template #muteNotifications>
    <div class="modal-header bg-accent-white">
        <h5 class="modal-title">Mute {{chat.chatInformation.chatName}} chat</h5>
        <span class="icon ki-close" (click)="modalRef.hide()"></span>
    </div>
    <div class="modal-body">
        <p>This will mute all the messages and notifications regarding this chat until it is unmuted.</p>
        <p>Do you wish to continue?</p>
    </div>
    <div class="modal-footer p-20">
        <button class="btn btn-secondary" (click)="modalRef.hide()">Cancel</button>
        <button class="btn bg-accent-violet text-white" (click)="muteClub()">Confirm</button>
    </div>
</ng-template>

<ng-template #leavechat>
    <div class="modal-header bg-accent-white">
        <h5 class="modal-title">Block {{chat.chatInformation.chatName}} chat</h5>
        <span class="icon ki-close" (click)="modalRef.hide()"></span>
    </div>
    <div class="modal-body">
        <p>You will no longer get messages from this chat</p>
        <p>Do you wish to continue?</p>
    </div>
    <div class="modal-footer p-20">
        <button class="btn btn-secondary" (click)="modalRef.hide()">Cancel</button>
        <button class="btn btn-danger">Block</button>
    </div>
</ng-template>
